<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Rekap Peserta | BPR/BPRS</title>
<style>
:root{
  --bg:#0d1117;
  --card:#161b22;
  --card-hover:#1c2128;
  --accent:#58a6ff;
  --accent-hover:#79b8ff;
  --success:#238636;
  --warning:#d29922;
  --danger:#da3633;
  --text:#c9d1d9;
  --text-muted:#8b949e;
  --border:#30363d;
  --shadow:0 4px 6px -1px rgba(0,0,0,0.3);
  --radius:8px;
  --font:13px;
  --transition:all 0.2s cubic-bezier(0.4,0,0.2,1);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  font-size:var(--font);
  line-height:1.5;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* ===== HEADER MODERN ===== */
header{
  background:var(--card);
  border-bottom:1px solid var(--border);
  padding:16px 20px;
  display:flex;
  flex-wrap:wrap;
  gap:16px;
  align-items:center;
  justify-content:space-between;
  position:sticky;
  top:0;
  z-index:100;
  backdrop-filter:blur(8px);
}
.brand{
  display:flex;
  align-items:center;
  gap:12px;
}
.brand-icon{
  width:40px;
  height:40px;
  background:linear-gradient(135deg,var(--accent),#0969da);
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  box-shadow:var(--shadow);
  animation:pulse 2s infinite;
}
@keyframes pulse{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.05)}
}
h1{
  font-size:18px;
  font-weight:600;
  letter-spacing:-0.5px;
  background:linear-gradient(90deg,var(--text),var(--accent));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.subtitle{
  font-size:11px;
  color:var(--text-muted);
  margin-top:2px;
}
.stats{
  display:flex;
  gap:16px;
  font-size:11px;
}
.stat-item{
  text-align:center;
}
.stat-value{
  font-size:16px;
  font-weight:700;
  color:var(--accent);
  display:block;
}
.stat-label{
  color:var(--text-muted);
  text-transform:uppercase;
  letter-spacing:0.5px;
  font-size:10px;
}

/* ===== FILTER MODERN ===== */
.filter-box{
  position:relative;
  flex:1;
  min-width:200px;
  max-width:400px;
}
.filter-box::before{
  content:'üîç';
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  font-size:14px;
  opacity:0.6;
  transition:var(--transition);
}
.filter-box:focus-within::before{
  opacity:1;
  transform:translateY(-50%) scale(1.1);
}
#filter{
  width:100%;
  padding:10px 12px 10px 36px;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:var(--radius);
  color:var(--text);
  font-size:var(--font);
  outline:none;
  transition:var(--transition);
}
#filter:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(88,166,255,0.1);
}
#filter::placeholder{color:var(--text-muted)}
.clear-btn{
  position:absolute;
  right:8px;
  top:50%;
  transform:translateY(-50%);
  background:none;
  border:none;
  color:var(--text-muted);
  cursor:pointer;
  padding:4px;
  border-radius:4px;
  opacity:0;
  transition:var(--transition);
  font-size:16px;
}
.filter-box:focus-within .clear-btn,
.filter-box.has-value .clear-btn{
  opacity:1;
}
.clear-btn:hover{
  color:var(--danger);
  background:rgba(218,54,51,0.1);
}

/* ===== MAIN CONTENT ===== */
main{
  flex:1;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:16px;
  container-type:inline-size;
}
.toolbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:12px;
}
.info-pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 12px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:20px;
  font-size:11px;
  color:var(--text-muted);
}
.info-pill .dot{
  width:8px;
  height:8px;
  background:var(--success);
  border-radius:50%;
  animation:blink 2s infinite;
}
@keyframes blink{
  0%,100%{opacity:1}
  50%{opacity:0.4}
}

/* ===== TABLE MODERN ===== */
.table-wrapper{
  flex:1;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
  box-shadow:var(--shadow);
  position:relative;
}
.table-scroll{
  max-height:calc(100vh - 280px);
  overflow:auto;
}
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  font-size:var(--font);
}
thead{
  position:sticky;
  top:0;
  z-index:10;
}
th{
  background:#010409;
  color:var(--accent);
  padding:12px 16px;
  text-align:left;
  font-weight:600;
  text-transform:uppercase;
  font-size:11px;
  letter-spacing:0.5px;
  border-bottom:1px solid var(--border);
  white-space:nowrap;
  cursor:pointer;
  user-select:none;
  transition:var(--transition);
}
th:hover{
  background:#0d1117;
  color:var(--accent-hover);
}
th.sortable::after{
  content:'‚Üï';
  margin-left:6px;
  opacity:0.3;
  font-size:10px;
}
th.sort-asc::after{content:'‚Üë';opacity:1}
th.sort-desc::after{content:'‚Üì';opacity:1}
td{
  padding:12px 16px;
  border-bottom:1px solid var(--border);
  color:var(--text);
  transition:var(--transition);
}
tbody tr{
  transition:var(--transition);
}
tbody tr:hover{
  background:var(--card-hover);
  transform:translateX(4px);
}
tbody tr:hover td{
  color:#fff;
}
tbody tr:last-child td{border-bottom:none}
.row-number{
  color:var(--text-muted);
  font-size:11px;
  font-weight:600;
  width:40px;
  text-align:center;
}
.badge{
  display:inline-flex;
  align-items:center;
  padding:4px 10px;
  border-radius:12px;
  font-size:11px;
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:0.3px;
}
.badge-active{
  background:rgba(35,134,54,0.15);
  color:#3fb950;
  border:1px solid rgba(35,134,54,0.3);
}
.badge-pending{
  background:rgba(210,153,34,0.15);
  color:#d29922;
  border:1px solid rgba(210,153,34,0.3);
}
.date-cell{
  font-family:'SF Mono',monospace;
  font-size:12px;
  color:var(--accent);
}
.link-btn{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 12px;
  background:rgba(88,166,255,0.1);
  color:var(--accent);
  text-decoration:none;
  border-radius:6px;
  font-size:11px;
  font-weight:600;
  transition:var(--transition);
  border:1px solid rgba(88,166,255,0.2);
}
.link-btn:hover{
  background:var(--accent);
  color:#fff;
  transform:translateY(-1px);
  box-shadow:0 4px 12px rgba(88,166,255,0.3);
}
.empty-state{
  text-align:center;
  padding:60px 20px;
  color:var(--text-muted);
}
.empty-state-icon{
  font-size:48px;
  margin-bottom:16px;
  opacity:0.5;
}

/* ===== LOADER MODERN ===== */
.loader-overlay{
  position:absolute;
  inset:0;
  background:rgba(13,17,23,0.9);
  backdrop-filter:blur(4px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:16px;
  z-index:50;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.3s;
}
.loader-overlay.active{
  opacity:1;
  pointer-events:all;
}
.spinner{
  width:40px;
  height:40px;
  border:3px solid var(--border);
  border-top-color:var(--accent);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.loader-text{
  color:var(--text-muted);
  font-size:12px;
  animation:pulse-text 1.5s ease-in-out infinite;
}
@keyframes pulse-text{
  0%,100%{opacity:0.5}
  50%{opacity:1}
}

/* ===== PAGINATION MODERN ===== */
.pagination{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:8px;
  padding:16px;
  background:var(--card);
  border-top:1px solid var(--border);
}
.pagi-btn{
  display:flex;
  align-items:center;
  justify-content:center;
  min-width:36px;
  height:36px;
  padding:0 12px;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:6px;
  color:var(--text);
  font-size:13px;
  cursor:pointer;
  transition:var(--transition);
}
.pagi-btn:hover:not(:disabled){
  border-color:var(--accent);
  color:var(--accent);
  transform:translateY(-1px);
}
.pagi-btn:disabled{
  opacity:0.4;
  cursor:not-allowed;
}
.pagi-info{
  padding:0 16px;
  color:var(--text-muted);
  font-size:12px;
  min-width:100px;
  text-align:center;
}
.page-numbers{
  display:flex;
  gap:4px;
}
.page-num{
  min-width:36px;
  height:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:6px;
  color:var(--text-muted);
  font-size:12px;
  cursor:pointer;
  transition:var(--transition);
}
.page-num:hover{
  border-color:var(--accent);
  color:var(--accent);
}
.page-num.active{
  background:var(--accent);
  border-color:var(--accent);
  color:#fff;
  font-weight:600;
}

/* ===== TOAST NOTIFICATION ===== */
.toast{
  position:fixed;
  bottom:20px;
  right:20px;
  padding:12px 20px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;
  align-items:center;
  gap:10px;
  transform:translateY(100px);
  opacity:0;
  transition:all 0.3s cubic-bezier(0.68,-0.55,0.265,1.55);
  z-index:1000;
}
.toast.show{
  transform:translateY(0);
  opacity:1;
}
.toast-icon{
  font-size:16px;
}
.toast-success{border-left:3px solid var(--success)}
.toast-error{border-left:3px solid var(--danger)}

/* ===== RESPONSIVE ===== */
@container (max-width:600px){
  header{padding:12px}
  .brand-icon{width:32px;height:32px;font-size:16px}
  h1{font-size:16px}
  .stats{display:none}
  th,td{padding:10px 12px;font-size:12px}
  .table-scroll{max-height:calc(100vh - 240px)}
}
@media (max-width:480px){
  :root{--font:12px}
  .pagination{flex-wrap:wrap;gap:4px}
  .page-numbers{display:none}
}
</style>
<base target="_blank">
</head>
<body>

<header>
  <div class="brand">
    <div class="brand-icon">üè¶</div>
    <div>
      <h1>LOKER BPR/BPRS</h1>
      <div class="subtitle">Sistem Rekrutmen Real-time</div>
    </div>
  </div>
  
  <div class="stats">
    <div class="stat-item">
      <span class="stat-value" id="total-count">0</span>
      <span class="stat-label">Total</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" id="filtered-count">0</span>
      <span class="stat-label">Filter</span>
    </div>
    <div class="stat-item">
      <span class="stat-value" id="page-count">0</span>
      <span class="stat-label">Halaman</span>
    </div>
  </div>

  <div class="filter-box" id="filter-box">
    <input id="filter" placeholder="Cari nama, posisi, atau status..." autocomplete="off"/>
    <button class="clear-btn" onclick="clearFilter()" title="Clear">√ó</button>
  </div>
</header>

<main>
  <div class="toolbar">
    <div class="info-pill">
      <span class="dot"></span>
      <span>Live Update ‚Ä¢ Refresh otomatis 10 detik</span>
    </div>
    <div class="info-pill" id="last-update">
      <span>üïê</span>
      <span>Terakhir update: -</span>
    </div>
  </div>

  <div class="table-wrapper">
    <div class="loader-overlay" id="loader">
      <div class="spinner"></div>
      <div class="loader-text">Memuat data...</div>
    </div>
    
    <div class="table-scroll">
      <table>
        <thead id="head"></thead>
        <tbody id="body"></tbody>
      </table>
      <div class="empty-state" id="empty-state" style="display:none">
        <div class="empty-state-icon">üîç</div>
        <div>Tidak ada data yang cocok</div>
        <div style="font-size:11px;margin-top:8px">Coba kata kunci lain</div>
      </div>
    </div>
    
    <div class="pagination" id="pagination"></div>
  </div>
</main>

<div class="toast" id="toast">
  <span class="toast-icon" id="toast-icon">‚úì</span>
  <span id="toast-msg">Update berhasil</span>
</div>

<script>
/* ===== CONFIG ===== */
const SHEET_URL='https://script.google.com/macros/s/AKfycbwXbg5SILF0GbqTw5gbv_XkQTTpIH6camaf5bhnLU5jTOxeoVdZ5wEeurjsDoXoIOL-/exec';
const ROWS_PER_PAGE=10;
const REFRESH_MS=10000;

/* ===== STATE ===== */
let raw=[[]], filtered=[[]], page=1, sortCol=-1, sortAsc=true, lastDataHash='';

/* ===== DOM ===== */
const $=s=>document.querySelector(s);
const head=$('#head'), body=$('#body'), pagination=$('#pagination'), 
      filter=$('#filter'), loader=$('#loader'), emptyState=$('#empty-state'),
      filterBox=$('#filter-box'), toast=$('#toast');

/* ===== UTILS ===== */
function hashData(data){
  return JSON.stringify(data).split('').reduce((a,b)=>((a<<5)-a)+b.charCodeAt(0),0);
}
function showToast(msg,type='success'){
  const icon=type==='success'?'‚úì':'‚úï';
  $('#toast-icon').textContent=icon;
  $('#toast-msg').textContent=msg;
  toast.className=`toast toast-${type} show`;
  setTimeout(()=>toast.classList.remove('show'),3000);
}
function formatDate(dateStr){
  if(!dateStr)return'-';
  const d=new Date(dateStr);
  if(isNaN(d))return dateStr;
  const dd=String(d.getDate()).padStart(2,'0');
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const yy=d.getFullYear();
  return `${dd}/${mm}/${yy}`;
}
function timeAgo(date){
  const sec=Math.floor((new Date()-date)/1000);
  if(sec<60)return 'baru saja';
  if(sec<3600)return `${Math.floor(sec/60)}m lalu`;
  if(sec<86400)return `${Math.floor(sec/3600)}j lalu`;
  return `${Math.floor(sec/86400)}h lalu`;
}

/* ===== FETCH ===== */
async function pull(showLoading=false){
  if(showLoading)loader.classList.add('active');
  try{
    const res=await fetch(SHEET_URL,{cache:'no-store'});
    const j=await res.json();
    const newHash=hashData(j);
    
    if(newHash!==lastDataHash){
      lastDataHash=newHash;
      raw=j;
      $('#last-update span:last-child').textContent=`Update: ${timeAgo(new Date())}`;
      if(filtered.length>1)showToast(`Data diperbarui! ${raw.length-1} baris`);
      applyFilter();
    }
  }catch(e){
    console.error(e);
    showToast('Gagal memuat data','error');
  }finally{
    if(showLoading)setTimeout(()=>loader.classList.remove('active'),500);
  }
}

/* ===== FILTER & SORT ===== */
function applyFilter(){
  const q=filter.value.trim().toLowerCase();
  filterBox.classList.toggle('has-value',q.length>0);
  
  if(!q){
    filtered=[...raw];
  }else{
    filtered=[raw[0], ...raw.slice(1).filter(r=>r.some(c=>String(c).toLowerCase().includes(q)))];
  }
  
  if(sortCol>=0)doSort();
  page=1;
  updateStats();
  render();
}
function clearFilter(){
  filter.value='';
  applyFilter();
  filter.focus();
}
function doSort(){
  const header=filtered[0];
  const data=filtered.slice(1);
  data.sort((a,b)=>{
    let va=a[sortCol], vb=b[sortCol];
    if(!isNaN(va)&&!isNaN(vb))return sortAsc?va-vb:vb-va;
    return sortAsc?String(va).localeCompare(vb):String(vb).localeCompare(va);
  });
  filtered=[header,...data];
}

/* ===== RENDER ===== */
function updateStats(){
  $('#total-count').textContent=Math.max(0,raw.length-1);
  $('#filtered-count').textContent=Math.max(0,filtered.length-1);
  $('#page-count').textContent=Math.ceil((filtered.length-1)/ROWS_PER_PAGE);
}
function render(){
  // Header dengan sort
  head.innerHTML='<tr>'+filtered[0].map((v,i)=>`
    <th class="sortable ${sortCol===i?(sortAsc?'sort-asc':'sort-desc'):''}" 
        onclick="setSort(${i})" title="Klik untuk urutkan">${v}</th>
  `).join('')+'</tr>';
  
  // Empty state
  if(filtered.length<=1){
    body.innerHTML='';
    emptyState.style.display='block';
    pagination.innerHTML='';
    return;
  }
  emptyState.style.display='none';
  
  // Body dengan pagination
  const start=(page-1)*ROWS_PER_PAGE+1;
  const end=Math.min(start+ROWS_PER_PAGE,filtered.length);
  const slice=filtered.slice(start,end);
  
  body.innerHTML=slice.map((r,idx)=>{
    const globalIdx=start+idx;
    return `<tr style="animation:fadeIn 0.3s ease ${idx*0.05}s both">
      <td class="row-number">${globalIdx}</td>
      ${r.map((c,i)=>`<td>${formatCell(c,i)}</td>`).join('')}
    </tr>`;
  }).join('');
  
  // Pagination
  const totalPages=Math.ceil((filtered.length-1)/ROWS_PER_PAGE);
  renderPagination(totalPages);
  
  // Scroll to top
  $('.table-scroll').scrollTop=0;
}
function formatCell(v,idx){
  if(!v)return'-';
  const str=String(v);
  
  // Link detection
  if(str.startsWith('http')){
    return `<a href="${v}" target="_blank" class="link-btn">
      <span>üîó</span><span>Buka</span>
    </a>`;
  }
  
  // Date detection (assume column 2 is date)
  if(idx===2){
    return `<span class="date-cell">${formatDate(v)}</span>`;
  }
  
  // Status badges
  const statusMap={
    'aktif':'badge-active','active':'badge-active',
    'pending':'badge-pending','proses':'badge-pending',
    'diterima':'badge-active','ditolak':'badge-pending'
  };
  const lower=str.toLowerCase();
  if(statusMap[lower]){
    return `<span class="badge ${statusMap[lower]}">${v}</span>`;
  }
  
  return v;
}
function renderPagination(total){
  if(total<=1){
    pagination.innerHTML='';
    return;
  }
  
  let html=`
    <button class="pagi-btn" onclick="changePage(${page-1})" ${page===1?'disabled':''}>
      ‚Äπ Prev
    </button>
    <div class="pagi-info">Halaman ${page} dari ${total}</div>
    <button class="pagi-btn" onclick="changePage(${page+1})" ${page===total?'disabled':''}>
      Next ‚Ä∫
    </button>
  `;
  
  // Page numbers untuk desktop
  if(window.innerWidth>480){
    html+=`<div class="page-numbers">`;
    for(let i=1;i<=total;i++){
      if(i===1||i===total||(i>=page-1&&i<=page+1)){
        html+=`<button class="page-num ${i===page?'active':''}" onclick="changePage(${i})">${i}</button>`;
      }else if(i===page-2||i===page+2){
        html+=`<span style="color:var(--text-muted)">...</span>`;
      }
    }
    html+=`</div>`;
  }
  
  pagination.innerHTML=html;
}

/* ===== ACTIONS ===== */
function setSort(col){
  if(sortCol===col)sortAsc=!sortAsc;
  else{sortCol=col;sortAsc=true;}
  applyFilter();
}
function changePage(p){
  page=p;
  render();
  $('.table-scroll').scrollTo({top:0,behavior:'smooth'});
}

/* ===== EVENTS ===== */
filter.addEventListener('input',debounce(applyFilter,300));
filter.addEventListener('keydown',e=>{
  if(e.key==='Escape')clearFilter();
});

function debounce(fn,ms){
  let t;
  return(...a)=>{
    clearTimeout(t);
    t=setTimeout(()=>fn(...a),ms);
  };
}

// Keyboard shortcuts
document.addEventListener('keydown',e=>{
  if(e.ctrlKey||e.metaKey){
    if(e.key==='f'){
      e.preventDefault();
      filter.focus();
    }
  }
  if(e.key==='ArrowLeft'&&page>1)changePage(page-1);
  if(e.key==='ArrowRight')changePage(page+1);
});

/* ===== INIT ===== */
const style=document.createElement('style');
style.textContent=`@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}`;
document.head.appendChild(style);

(async()=>{
  loader.classList.add('active');
  await pull();
  loader.classList.remove('active');
  setInterval(()=>pull(false),REFRESH_MS);
})();
</script>
</body>
</html>
